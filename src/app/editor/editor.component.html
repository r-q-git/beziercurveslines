<div class="relative w-screen h-screen flex items-center justify-center">
  <div
    class="fixed top-0 left-0 m-2 z-50 flex flex-col sm:flex-row justify-center items-center space-y-2 sm:space-y-0 sm:space-x-2"
  >
    <button
      (click)="addNewLine('straight')"
      class="w-9 h-9 shadow-2 rounded cursor-pointer flex items-center justify-center bg-white border shadow-md shadow-[#f6f9fb] hover:border-[#ff9100] hover:scale-[1.1]"
      title="Add Straight Line"
    >
      <img src="/assets/line.svg" class="" />
    </button>
    <button
      (click)="addNewLine('step')"
      class="w-9 h-9 rounded shadow-2 cursor-pointer flex items-center justify-center bg-white border shadow-md shadow-[#f6f9fb] hover:border-[#ff9100] hover:scale-[1.1]"
      title="Add Step Line"
    >
      <img src="/assets/step.svg" class="" />
    </button>
    <button
      (click)="addNewLine('curve')"
      class="w-9 h-9 rounded shadow-2 cursor-pointer flex items-center justify-center bg-white border shadow-md shadow-[#f6f9fb] hover:border-[#ff9100] hover:scale-[1.1]"
      title="Add Curve Line"
    >
      <img src="/assets/curve.svg" class="" />
    </button>
  </div>

  <div
    *ngIf="activeId"
    class="fixed top-0 m-3 px-2 rounded-lg z-50 flex items-center justify-center space-x-2 bg-white border shadow shadow-[#f6f9fb] h-10"
  >
    <img
      (click)="toggleLineStyle()"
      [title]="
        activeLine?.type === 'curve' ? 'Switch to Pointy' : 'Switch to Smooth'
      "
      class="cursor-pointer h-8 hover:bg-[#f6f9fb] hover:border rounded-md"
      [src]="
        activeLine?.type === 'curve'
          ? '/assets/roundy.svg'
          : '/assets/pointy.svg'
      "
    />
    <div class="relative flex items-center justify-center">
      <img
        title="Line Width"
        class="cursor-pointer h-8 p-1 hover:bg-[#f6f9fb] hover:border rounded-md"
        [src]="
          menuStates.width ? '/assets/linewidth2.svg' : '/assets/linewidth.svg'
        "
        (click)="menuStates.width = !menuStates.width"
      />

      <div
        *ngIf="menuStates.width"
        title="Line Width"
        class="absolute top-8 mt-3 px-4 py-3 min-w-44 flex flex-col items-start justify-center gap-3 rounded-md bg-white border shadow shadow-[#f6f9fb]"
      >
        <div class="flex flex-col items-start justify-center gap-2 w-full">
          <span class="text-xs font-semibold" title="Stroke Style"
            >Stroke Style</span
          >
          <div class="flex items-start justify-between w-full">
            <button
              title="Stroke Style : Solid"
              [disabled]="activeLine?.locked"
              class="w-9 h-9 p-1 flex items-center justify-center shadow cursor-pointer hover:bg-[#f6f9fb] hover:border rounded-md"
              (click)="updateActiveLine(null, null, false, 'solid')"
              [ngClass]="activeLine?.locked ? 'text-gray-200' : 'text-black'"
              [ngClass]="
                activeLine?.strokeStyle == 'solid'
                  ? 'border border-[#ff9100] text-[#ff9100]'
                  : 'text-black'
              "
            >
              <!-- ls- stands for line style -->

              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <line
                  x2="24"
                  y1="50%"
                  y2="50%"
                  stroke="currentColor"
                  stroke-width="2"
                  shape-rendering="crispEdges"
                ></line>
              </svg>
            </button>
            <button
              title="Stroke Style : Dashed"
              [disabled]="activeLine?.locked"
              class="w-9 h-9 p-1 flex items-center justify-center shadow cursor-pointer hover:bg-[#f6f9fb] hover:border rounded-md"
              (click)="updateActiveLine(null, null, false, 'dashed')"
              [ngClass]="activeLine?.locked ? 'text-gray-200' : 'text-black'"
              [ngClass]="
                activeLine?.strokeStyle == 'dashed'
                  ? 'border border-[#ff9100] text-[#ff9100]'
                  : 'text-black'
              "
            >
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <line
                  x1="1"
                  x2="23"
                  y1="50%"
                  y2="50%"
                  stroke="currentColor"
                  stroke-dasharray="6 2"
                  stroke-width="2"
                  shape-rendering="crispEdges"
                ></line>
              </svg>
            </button>
            <button
              title="Stroke Style : Dotted"
              [disabled]="activeLine?.locked"
              class="w-9 h-9 p-1 flex items-center justify-end shadow cursor-pointer hover:bg-[#f6f9fb] hover:border rounded-md"
              (click)="updateActiveLine(null, null, false, 'dotted')"
              [ngClass]="activeLine?.locked ? 'text-gray-200' : 'text-black'"
              [ngClass]="
                activeLine?.strokeStyle == 'dotted'
                  ? 'border border-[#ff9100] text-[#ff9100]'
                  : 'text-black'
              "
            >
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <line
                  x1="2"
                  x2="22"
                  y1="50%"
                  y2="50%"
                  stroke="currentColor"
                  stroke-width="3"
                  stroke-dasharray="0 6"
                  stroke-linecap="round"
                ></line>
              </svg>
            </button>
          </div>
        </div>

        <div class="flex flex-col items-start justify-center gap-3 w-full">
          <span class="text-xs font-semibold">Line Width</span>
          <div class="flex items-center justify-center gap-2">
            <input
              type="range"
              step="1"
              min="0.5"
              title="Slide to adjust width"
              [value]="activeLine?.width || 2"
              (input)="onWidthChange($any($event.target).value)"
              class="w-full h-2 cursor-pointer appearance-none rounded-lg border shadow-sm"
              [disabled]="activeLine?.locked"
              [style.accentColor]="'#ff9100'"
            />

            <input
              type="number"
              min="0.5"
              title="Line Width"
              [value]="activeLine?.width || 2"
              (input)="onWidthChange($any($event.target).value)"
              class="w-9 h-8 p-1 text-center text-sm no-spinners rounded-md border shadow shadow-[#f6f9fb]"
              [disabled]="activeLine?.locked"
            />
          </div>
        </div>
      </div>
    </div>

    <div
      class="flex items-center justify-center h-8 w-8 rounded-md hover:bg-[#f6f9fb] hover:border"
    >
      <div
        class="relative w-6 border-2 cursor-pointer transition-all flex items-center justify-center h-6 rounded-full focus-within:border-[#ff9100]"
        [style.backgroundColor]="activeLine?.color || '#000000'"
        (click)="colorInput.click()"
        title="Change Color"
      >
        <input
          #colorInput
          type="color"
          class="absolute top-3.5 opacity-0 w-full h-full cursor-pointer disabled:cursor-not-allowed"
          [value]="activeLine?.color || '#000000'"
          (input)="updateActiveLine($any($event.target).value, null)"
          [disabled]="activeLine?.locked"
        />
      </div>
    </div>

    <img
      title="Lock Line"
      class="cursor-pointer p-1 h-8 w-8 rounded-md hover:bg-[#f6f9fb] hover:border"
      [src]="activeLine?.locked ? '/assets/lock.svg ' : '/assets/unlock.svg'"
      (click)="updateActiveLine(null, null, true)"
    />

    <div
      title="Delete Line"
      class="cursor-pointer p-1 h-8 w-8 rounded-md hover:bg-[#f6f9fb] hover:border"
      (click)="deleteActiveLine()"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        height="24px"
        viewBox="0 -960 960 960"
        width="24px"
        class="hover:fill-[#ff9100]"
      >
        <path
          d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"
        />
      </svg>
    </div>
  </div>

  <canvas
    #editorCanvas
    (mousedown)="onMouseDown($event)"
    (mousemove)="onMouseMove($event)"
    (mouseup)="onMouseUp()"
    (dblclick)="onDoubleClick($event)"
    class="block w-full h-full"
  >
  </canvas>

  <div
    class="fixed bottom-0 w-full z-50 flex flex-col items-center pointer-events-none text-sm"
  >
    <!-- Toggle Button -->
    <button
      (click)="showFooter = !showFooter"
      class="absolute bottom-20 sm:bottom-16 md:bottom-12 lg:bottom-5 right-4 z-50 w-10 h-10 p-1 bg-white hover:bg-[#f6f9fb] border hover:border-2 rounded-md cursor-pointer flex items-center justify-center pointer-events-auto"
      [ngClass]="showFooter ? 'border-[#ff9100]' : ''"
    >
      <img
        class="w-8 h-8"
        [src]="showFooter ? '/assets/down.svg' : '/assets/up.svg'"
      />
    </button>

    <!-- Footer Panel -->
    <div
      class="w-[95%] sm:w-[85%] md:w-2/3 px-4 sm:px-6 md:px-10 py-3 my-2 bg-white border shadow shadow-[#f6f9fb] rounded-xl transition-all duration-300 ease-in-out pointer-events-auto"
      [class.translate-y-full]="!showFooter"
      [class.opacity-0]="!showFooter"
      [class.opacity-100]="showFooter"
    >
      <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
        <!-- Left Section -->
        <div
          class="flex flex-col sm:flex-row items-center justify-between gap-4 flex-wrap"
        >
          <div class="flex items-center gap-2 flex-wrap">
            <button
              class="w-9 h-9 p-2 flex items-center justify-center cursor-pointer hover:bg-[#f6f9fb] hover:border rounded-md active:border-[#ff9100] active:text-[#ff9100]"
              (click)="adjustZoom(-0.1)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                height="24px"
                viewBox="0 -960 960 960"
                width="24px"
                fill="currentColor"
              >
                <path d="M200-440v-80h560v80H200Z" />
              </svg>
            </button>

            <input
              type="range"
              min="0.1"
              max="2.0"
              step="0.1"
              [(ngModel)]="zoomLevel"
              (input)="render()"
              class="cursor-pointer rounded-lg"
              [style.accentColor]="'#ff9100'"
            />

            <button
              class="w-9 h-9 p-2 flex items-center justify-center cursor-pointer hover:bg-[#f6f9fb] hover:border rounded-md active:border-[#ff9100] active:text-[#ff9100]"
              (click)="adjustZoom(0.1)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                height="24px"
                viewBox="0 -960 960 960"
                width="24px"
                fill="currentColor"
              >
                <path
                  d="M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z"
                />
              </svg>
            </button>

            <button
              (click)="resetZoom()"
              class="px-3 py-2 cursor-pointer border hover:bg-[#f6f9fb] hover:border active:text-[#ff9100] rounded-md active:border-[#ff9100]"
            >
              Reset Zoom
            </button>
          </div>

          <div
            class="flex items-center gap-1 px-4 py-1 border focus-within:border-[#ff9100] bg-white hover:bg-[#f6f9fb] hover:border rounded-md"
          >
            <input
              type="number"
              [value]="(zoomLevel * 100).toFixed(0)"
              (change)="onZoomInput($any($event.target).value)"
              class="w-7 h-7 text-center text-sm no-spinners bg-inherit"
            />
            <span class="font-medium">%</span>
          </div>
        </div>

        <!-- Right Button -->
        <button
          (click)="addToProject()"
          class="px-3 py-2 flex items-center gap-2 hover:text-[#ff9100] cursor-pointer border hover:bg-[#f6f9fb] hover:border rounded-md active:border-2 active:border-[#ff9100]"
        >
          Add to Project
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="24px"
            viewBox="0 -960 960 960"
            width="24px"
            fill="currentColor"
          >
            <path
              d="M120-160v-640l760 320-760 320Zm80-120 474-200-474-200v140l240 60-240 60v140Zm0 0v-400 400Z"
            />
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>
